<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>jqGrid Demos</title>

<!-- In head section we should include the style sheet for the grid -->
<link rel="stylesheet" type="text/css" media="screen" href="css/ui.jqgrid.css" />
<link rel="stylesheet" type="text/css" media="screen" href="js/jquery/theme/cupertino/jquery-ui-1.7.3.custom.css" />

<script src="js/jquery/jquery-1.7.2.min.js" type="text/javascript"></script>
<script src="js/jquery/jquery-ui-1.7.3.custom.min.js" type="text/javascript"></script>

<script src="js/i18n/grid.locale-en.js" type="text/javascript"></script>
<script src="js/jqgrid/jquery.jqGrid.min.js" type="text/javascript"></script>

<script type="text/javascript">


      
$(function() {
	$('#loadingDiv').hide();
	$('#queryButton').click(function() {
		sqlQuery($('#sql').val());
    });
	
	$('#clear').click(function() {
		clear();
    });
});

function sqlQuery(sql) {
	$.ajax({
        url: "rest/query/query",
        dataType: "json",
        type: 'POST',
        data: sql,
        beforeSend: function () {
            $("#loadingDiv").show();
        },
        success: function (result) {
            if (result) {
                if (!result.Error) {
                	renderGrid(result.colNames, result.colModel, result.rows);
                }
            }
        },
        error: function (xhr, ajaxOptions, thrownError) {
            if (xhr && thrownError) {
                alert('Status: ' + xhr.status + ' Error: ' + thrownError);
            }
        },
        complete: function () {
            $("#loadingDiv").hide();
        }
    });
}

function renderGrid(colNames, colModel, rows) {
	
	$('#list47').jqGrid('GridUnload');

	
	var lastgridsel;
    jQuery("#list47").jqGrid({
        data: [],
        datatype: "local",
        height: 150,
        rowNum: 10,
        rowList: [10,20,30],
        colNames: colNames,
        colModel: colModel,
        pager: "#plist47",
        viewrecords: true,
        caption: "Manipulating Array Data",
        onSelectRow: function(id) {
            if (id && id !== lastgridsel) {
                jQuery('#list47').jqGrid('saveRow',lastgridsel, false, 'clientArray');
                jQuery('#list47').jqGrid('editRow',id, true, null, null,'clientArray');
                lastgridsel = id;
            }
        }
    });
    
    $("#list47").jqGrid('gridResize');
    $("#list47").jqGrid("clearGridData", true).trigger("reloadGrid");
    

    for(var i=0; i<=rows.length; i++) {
    	jQuery("#list47").jqGrid('addRowData',i+1,rows[i]);
    }
    
    //$('#list47').jqGrid('GridUnload');
}

function clear() {
	$("#list47").jqGrid("clearGridData", true).trigger("reloadGrid");
}

</script>

</head>
<body>

    <textarea id="sql"></textarea><br>
    <button id="queryButton">Submit</button>
    
    <br>
    
    <button id="clear">Clear</button>
    
    <br>
    
    <div id="loadingDiv">loading...</div>
	<table id="list47"></table>
	<div id="plist47"></div>
	
</body>
</html>